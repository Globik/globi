<a href='/'>home</a><br><a href='/logout'>logout</a>

Username: <%= user.username %>

Email: <%= user.email %>

User ID: <%= user.id %>

User password: <%= user.password %>
</br>
<textarea id="tex" name="non-name" placeholder="type this" ></textarea>
<button id="btn-add" onclick="addData(event);">Send data</button></form>
<br>
<div id="status"><b>Here can be figcaption</b></div>
<table>
<caption>Caption about Tasks</caption>
<thead>
<tr>
<th>tasks</th><th>status</th><th>edit</th><th>delete</th>
</tr>
</thead>
<tbody id="task-body">

</tbody>
</table>
</div>
<button id=bu onclick="callDB(this)">callDB</button>
</br>
<textarea id="edittex" name="non-name" placeholder="edit this" ></textarea>
<button id="btn-add" onclick="addEdit(this);">edit data</button>
</br>
<span id='out4'>test</span>
<span id='txarout'></span>
<span id='out'></span>
<button onclick="doDel(this);">POST delete</button></br>
<button onclick="doGetDel(this);">GET delete</button></br>
<button onclick="doDeleteDel(this);">DELETE delete</button>
<script>

function callDB(e){
var xhr=new XMLHttpRequest();


xhr.open('GET', '/paramorig', true);

xhr.onload=function(e){
if(this.status ==200){

var data=JSON.parse(this.response);
document.getElementById('task-body').innerHTML='';

for( var key in data.task){

var datid=data._id[key];
 
var str='<input data-numb="'+datid+'" class="btn-edit" type="button" value="edit"/>';
var str2='<input data-numb="'+datid+'" class="btn-del" type="button" value="delete" onclick="deleteTask(this)"/>';
//editTx.textContent=data.task[8];
if(!document.getElementById('task-body').childNodes[key]){
document.getElementById('task-body').innerHTML+='<tr><th>'
+data.task[key]+'</th><th>'+data.completed[key]+'</th><th>'+str+'</th><th>'+str2+'</th></tr>';
} 
}
}

var divstat=document.getElementById('task-body');
var edits=divstat.getElementsByClassName('btn-edit');
for(var i=0;i<edits.length;i++){
var edit=edits[i];
edit.addEventListener('click',editdibk,false);
}
};
xhr.send();

}

var editTx=document.getElementById('edittex');
var txarout=document.getElementById('txarout');
txarout.textContent=editTx.value='';

function editdibk(e){
var eved=e.target;
var showeved=eved.getAttribute('data-numb');
 editTx.setAttribute('data-edit',showeved);
//alert(showeved +' data.task: //'+e.target.parentNode.parentNode.textContent);
e.preventDefault();
var txarout=document.getElementById('txarout');
//txarout.textContent=
editTx.value=e.target.parentNode.parentNode.firstChild.innerHTML;


/***
var xhr=new XMLHttpRequest();

xhr.open('POST', '/edit', true);
xhr.setRequestHeader('Content-type','application/json');
editTx.textContent='';
xhr.onload=function(e){
if(this.status ==200){
var txarout=document.getElementById('txarout');
txarout.textContent=editTx.value=this.response;

}
}
xhr.onerror=function(e){alert('fuck');console.log('fuck');};
***/
/***
var data={};
    data.editi=showeved;
var data=JSON.stringify(data);
//xhr.send(data);
***/
}

function addEdit(e){
//e.preventDefault();
var errCount=0;
if(editTx.value === ''){errCount++}

if(errCount === 0){
var xhr=new XMLHttpRequest();

xhr.open('POST', '/savedit', true);
xhr.setRequestHeader('Content-type','application/json');
xhr.onload=function(e){
if(this.status ==200){

//document.getElementById('out').innerHTML=this.response;
//document.getElementById('edittex').textContent='';
document.getElementById('out').innerHTML=this.response;
}
}
xhr.onerror=function(e){alert('fuck');console.log('fuck');};

var adel=document.getElementById('tex');
var data={};
var txarout=document.getElementById('txarout');
txarout.textContent=editTx.value;
data.name=txarout.textContent;
data._id=editTx.getAttribute('data-edit');

var data=JSON.stringify(data);
xhr.send(data);

setTimeout(callDB,1000);
} else{ alert('Please fill in the field');}
}


function addData(event){
event.preventDefault();
var errCount=0;
if(document.getElementById('tex').value ===''){
errCount++;}
 if(errCount === 0){
var xhr=new XMLHttpRequest();

xhr.open('POST', '/angaben', true);
xhr.setRequestHeader('Content-type','application/json');
xhr.onload=function(e){
if(this.status ==200){
var bl=JSON.parse(this.response);

document.getElementById('out').innerHTML=bl.name+" "+this.response;
}
}
xhr.onerror=function(e){alert('Ajax not available');console.log('fuck');};

var adel=document.getElementById('tex');
var data={};
var txarout=document.getElementById('txarout');
txarout.textContent=adel.value;
data.name=txarout.textContent;
//data.name=htmlEscape(adel.value);
var data=JSON.stringify(data);
xhr.send(data);
setTimeout(callDB,1000);
} else{ alert("Please fill in the field");return false;}
}

function deleteTask(el){
//var el=e.target;
var show=el.getAttribute('data-numb');
var confirmation = confirm('Are you sure you want to delete this task?');
if (confirmation === true) {

alert("OK, man, I'm about deleting this id of task:"+show);}
else{ return false;}
}

//*****
function doDel(event){
var xhr=new XMLHttpRequest();

xhr.open('POST', '/delta', true);
xhr.setRequestHeader('Content-type','application/json');
xhr.onload=function(e){
if(this.status ==200){

document.getElementById('out').innerHTML=this.response;
}
}
xhr.onerror=function(e){alert('fuck');console.log('fuck');};
var data={};
data.name="alik";

xhr.send(JSON.stringify(data));
}
function doGetDel(event){
var xhr=new XMLHttpRequest();

xhr.open('GET', '/alfa/gafu', true);
//xhr.setRequestHeader('Content-type','application/json');
xhr.onload=function(e){
if(this.status ==200){

document.getElementById('out').innerHTML=this.response;
}
}

xhr.send();
}

function doDeleteDel(event){
var xhr=new XMLHttpRequest();

xhr.open('DELETE', '/deletetask/666', true);
//xhr.setRequestHeader('Content-type','application/json');
xhr.onload=function(e){
if(this.status ==200){

document.getElementById('out').innerHTML=this.response;
}
}
xhr.onerror=function(e){alert('fuck');console.log('fuck');};

xhr.send();
}
</script>